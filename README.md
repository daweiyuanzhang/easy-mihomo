# Easy-Mihomo for Unraid and fnos

一个为 Unraid和fnos系统设计的 Mihomo Web 管理插件。

## 技术支持

- **Telegram 群组**：[点击加入](https://t.me/+7jcTMePlNVwwZjg1) - 获取配置文件模板和插件安装包
- **GitHub 主页**：[https://github.com/wlaosj](https://github.com/wlaosj) - 更多插件

## 功能特点

- 🚀 **一键安装**：通过 Unraid 插件系统轻松安装
- 🌐 **Web 管理**：友好的 Web 界面管理服务
- 📁 **多配置支持**：支持多个配置文件切换，选择后自动保存
- 🔄 **开机自启**：支持系统启动时自动启动（不依赖阵列）
- 🎨 **现代 UI**：集成 Zashboard 控制台界面
- 📝 **弹出编辑**：大窗口弹出式配置编辑器，提供更好的编辑体验
- 🔧 **灵活配置**：用户可上传自定义配置文件
- 📊 **智能日志**：自动日志清理（每6小时+启动时，超2MB自动清理）
- ⚡ **版本管理**：核心与UI自动检测更新，一键升级
- 🎯 **架构优化**：支持3种CPU架构（标准版/兼容版/v3优化版）

## 系统要求

- Unraid 6.12.0 或更高版本
- 至少 50MB 可用空间

## unraid安装方法

### 通过 URL 安装

1. 在 Unraid Web 界面进入 **Plugins** 页面
2. 点击 **"Install Plugin"**
3. 输入以下 URL：
   ```
   https://raw.githubusercontent.com/wlaosj/easy-mihomo/refs/heads/main/mihomo.plg
   ```
4. 点击 **"Install"** 开始安装

## 飞牛NAS安装方法

### 通过离线安装包安装

1. 下载离线安装包：
   - [点击加入](https://t.me/+7jcTMePlNVwwZjg1) - 获取插件安装包

2. 在飞牛NAS中安装：
   - 打开飞牛NAS的应用中心
   - 点击 **"离线安装"** 或 **"本地安装"**
   - 选择下载的 `easy-mihomo-2025.11.11.fpk` 文件
   - 点击 **"安装"** 开始安装

3. 安装完成后：
   - 在应用中心找到 **Easy-Mihomo** 应用
   - 点击打开应用，首次使用需要进行 B站粉丝验证
   - 输入您的 B站 MID 并完成验证后即可使用

## 使用指南

### 1. 上传配置文件

安装完成后，需要上传 Mihomo 配置文件：

1. 在插件界面点击 **"📂 打开配置文件夹"** 按钮
2. 或通过 SMB/FTP/SSH 访问 `/boot/config/plugins/easy-mihomo/` 目录
3. 上传您的 `.yaml` 或 `.yml` 配置文件

### 2. 下载核心和UI组件

1. 点击 **"下载/更新核心"** 按钮下载 Mihomo 核心文件
2. 点击 **"下载/更新UI"** 按钮下载 Zashboard 控制台界面
3. 下载完成后会自动显示 ✅ 完成提示

### 3. 选择配置文件

1. 在 **"配置"** 下拉菜单中选择配置文件
2. 选择后会自动保存，无需手动点击保存

### 4. 启动服务

1. 点击 **"启动"** 按钮启动 Mihomo 服务
2. 状态显示为 **🟢 运行中** 表示启动成功

### 5. 管理服务

- **停止**：停止 Mihomo 服务
- **重启服务**：重启 Mihomo 服务
- **清空日志**：清空服务日志
- **智能清理**：智能清理日志，保留最近1000行
- **打开控制台**：打开 Zashboard 控制台

## 高级功能

### 开机自启动

1. 勾选 **"开机即启动（不依赖阵列）"**
2. 点击 **"保存"**
3. 系统重启后会自动启动 Mihomo 服务

### 弹出式配置编辑

1. 选择要编辑的配置文件
2. 点击 **"编辑配置"** 按钮打开大窗口编辑器
3. 在弹出窗口中编辑配置内容
4. 可选择 **"保存后重启服务"** 自动应用更改
5. 支持多种关闭方式：取消按钮、ESC键、点击背景

### 多配置文件管理

- 支持上传多个配置文件
- 可以随时切换不同的配置，选择后自动保存
- 每个配置文件独立管理
- 支持刷新配置列表功能

## 日志管理

- **服务日志**：`/var/log/mihomo.log`
- **自动清理**：每6小时+启动时检查，超过2MB自动清理，保留最近1000行
- **日志查看**：点击"查看日志"打开日志查看器
- **手动清理**：点击"清空日志"完全清空日志文件
- **日志监控**：实时显示日志文件大小和行数

## 故障排除

### 服务无法启动

1. 检查是否已选择配置文件
2. 检查配置文件格式是否正确
3. 查看日志文件获取详细错误信息

### 配置文件问题

1. 确保文件格式为 `.yaml` 或 `.yml`
2. 检查 YAML 语法是否正确
3. 确保配置文件路径正确

### 网络问题

1. 检查代理端口是否被占用
2. 确认防火墙设置
3. 验证代理服务器连接

## 卸载方法

1. 在 Unraid 插件页面找到 **Easy-Mihomo**
2. 点击 **"Remove"** 按钮
3. 确认卸载，所有相关文件将被清理

## 技术支持

## 更新日志

### v1.1.0 (2025-11-06)
- ⭐ 核心与UI自动检测更新，一键升级
- ⭐ 支持3种CPU架构：标准版/兼容版/v3优化版
- ⭐ 智能下载管理：自动重试、进度显示、错误提示
- 核心显示实际安装的版本类型（如 1.19.15 [v3优化版]）
- 支持服务运行时下载核心（重启后生效）
- 日志自动清理：每6小时检查，超过2MB保留最近1000行
- 界面布局优化：操作更流畅，信息更清晰

### v1.0.3
- 优化：简化配置覆写逻辑，只覆写UI相关配置项（external-ui-url/name、external-ui）
- 优化：端口和密码信息从配置文件动态读取，支持用户自定义配置
- 优化：页面显示信息与实际配置完全一致，提升用户体验
- 优化：仪表板和控制台链接使用动态端口，支持自定义端口配置
- 优化：减少不必要的配置干预，给用户更多配置灵活性
- 修复：确保配置修改后页面显示立即反映变化

### v1.0.2
- 修复：弹出式配置编辑器保存后未生效的问题（提前初始化所选配置并在保存时做防御性回读）。
- 优化：启动时统一标准化关键配置项（`external-ui-url`/`external-ui-name`/`external-ui`、`external-controller`、`secret`），自动覆写或追加以提升兼容性。
- 清理：移除重复的 `external-ui` 覆写逻辑，合并为一次性备份+统一 upsert 的做法，提升可维护性。
- 体验：在“打开控制台”按钮后新增行内提示（主机/端口/密码），主机自动填充当前 Unraid 内网主机名；端口固定 `9090`，密码固定 `yyds666`。
- 新增：仪表板显示模块（Dashboard Tile），自动每5秒刷新，展示运行状态、版本、当前配置、内存占用与运行时间，并提供启动/重启/停止/打开UI的快捷按钮。

### v1.0.1
- 新增自动日志清理功能
- 支持定期清理（每天凌晨2点）
- 智能保留最近1000行日志
- 添加日志状态监控显示
- 新增手动智能清理按钮
- 优化日志文件大小管理
- 改进配置选择体验，支持自动保存
- 新增弹出式配置编辑器，提供更大编辑空间
- 优化界面布局，操作按钮更合理
- 改进下载进度显示，支持自动消失提示
- 更新核心版本到 v1.19.15

### v1.0.0
- 初始版本发布
- 支持基本的代理功能
- 集成 Web 管理界面
- 支持开机自启动
- 支持多配置文件管理
- 支持在线编辑配置
- 内置 mihomo v1.19.14 核心

---

**注意**：使用代理服务请遵守当地法律法规，本插件仅供学习和研究使用。

---

💜 喜欢此插件？通过 [爱发电](https://afdian.com/a/docker) 支持作者 | 🔗 [GitHub 主页](https://github.com/wlaosj) 更多插件 | 📱 [Telegram 群组](https://t.me/+7jcTMePlNVwwZjg1) 获取配置
